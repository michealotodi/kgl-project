{% extends "base.html" %}
{% load static %}

{% block title %}Director Dashboard{% endblock %}

{% block content %}
<form method="post" action="{% url 'logout' %}" style="display: inline;">
  {% csrf_token %}
  <button type="submit" 
      style="background-color: #0d6efd; 
             color: white; 
             border: none; 
             padding: 10px 20px; 
             border-radius: 5px; 
             font-size: 16px; 
             font-weight: bold; 
             cursor: pointer;
             transition: background-color 0.3s;">
     ðŸ”“ Logout
  </button>
</form>
<div class="container mt-4">
  <div class="text-center text-white py-3 mb-4 rounded" style="background-color: #2c3e50;">
    <h2>Director Dashboard - All Branches</h2>
  </div>
  <div class="alert alert-warning mt-3">
    <p>
      Some products may be low in stock. 
      <a href="{% url 'low_stock_alerts' %}">Check alerts</a>.
    </p>
  </div>
  
  <!-- Total Stats for All Branches -->
  <div class="row text-center">
    <div class="col-md-3 mb-4">
      <div class="p-3 bg-light border rounded shadow-sm">
        <h6 class="text-muted">Total Procured (Kg)</h6>
        <p class="display-6 text-dark">{{ total_procured }}</p>
      </div>
    </div>
    <div class="col-md-3 mb-4">
      <div class="p-3 bg-light border rounded shadow-sm">
        <h6 class="text-muted">Total Sold (Kg)</h6>
        <p class="display-6 text-dark">{{ total_sales }}</p>
      </div>
    </div>
    <div class="col-md-3 mb-4">
      <div class="p-3 bg-light border rounded shadow-sm">
        <h6 class="text-muted">Total Credit Sales (Kg)</h6>
        <p class="display-6 text-dark">{{ total_credit_sales }}</p>
      </div>
    </div>
    <div class="col-md-3 mb-4">
      <div class="p-3 bg-light border rounded shadow-sm">
        <h6 class="text-muted">Total Due (UGX)</h6>
        <p class="display-6 text-dark">UGX {{ total_due }}</p>
      </div>
    </div>
  </div>

  <!-- Stats for Each Branch -->
  <h4 class="text-secondary mt-4">Branch-wise Summary</h4>

  {% for stat in branch_stats %}
    <h5 class="text-primary mt-4">Branch: {{ stat.branch }}</h5>

    <!-- Sales Stats -->
    <div class="row text-center">
      <div class="col-md-3 mb-4">
        <div class="p-3 bg-light border rounded shadow-sm">
          <h6 class="text-muted">Total Sold (Kg)</h6>
          <p class="display-6 text-dark">{{ stat.total_sales }}</p>
        </div>
      </div>
      <div class="col-md-3 mb-4">
        <div class="p-3 bg-light border rounded shadow-sm">
          <h6 class="text-muted">Sales Amount (UGX)</h6>
          <p class="display-6 text-dark">UGX {{ stat.sales_amount }}</p>
        </div>
      </div>
    </div>

    <!-- Credit Sales Stats -->
    <div class="row text-center">
      <div class="col-md-3 mb-4">
        <div class="p-3 bg-light border rounded shadow-sm">
          <h6 class="text-muted">Total Credit Sales (Kg)</h6>
          <p class="display-6 text-dark">{{ stat.total_credit_sales }}</p>
        </div>
      </div>
      <div class="col-md-3 mb-4">
        <div class="p-3 bg-light border rounded shadow-sm">
          <h6 class="text-muted">Credit Sales Due (UGX)</h6>
          <p class="display-6 text-dark">UGX {{ stat.credit_due }}</p>
        </div>
      </div>
    </div>

    <!-- Procurement Stats -->
    <div class="row text-center">
      <div class="col-md-3 mb-4">
        <div class="p-3 bg-light border rounded shadow-sm">
          <h6 class="text-muted">Total Procured (Kg)</h6>
          <p class="display-6 text-dark">{{ stat.total_procured }}</p>
        </div>
      </div>
    </div>
  {% endfor %}

  {% if low_stock_items %}
  <h4 class="text-danger mt-5">Low Stock Items</h4>
  <ul class="list-group">
    {% for item in low_stock_items %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      {{ item.item }} ({{ item.quantity }} Kg)
      <span class="badge bg-warning text-dark">Low</span>
    </li>
    {% endfor %}
  </ul>
  {% endif %}
</div>

<footer class="site-footer mt-5">
  <p>&copy; 2025 KGLApp. All rights reserved.</p>
  <p>Contact us: <a href="mailto:info@kglapp.com">info@kglapp.com</a></p>
</footer>
{% endblock %}
